<!DOCTYPE html>
<html class="h-full bg-white dark:bg-gray-900" lang="en">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <title>MeasureReport</title>
</head>

<body>
<div class="mx-auto max-w-7xl sm:p-6 lg:p-8 bg-gray-100 dark:bg-gray-800/50">
    <div class="overflow-hidden rounded-lg bg-white shadow-sm dark:bg-gray-800/50 dark:shadow-none dark:outline dark:-outline-offset-1 dark:outline-white/10 mb-8">
        <div class="px-4 py-5 sm:p-6">
            <div class="md:flex md:items-center md:justify-between">
                <div class="min-w-0 flex-1">
                    <h1 class="text-2xl/7 font-bold text-gray-900 sm:truncate sm:text-3xl sm:tracking-tight dark:text-white">
                        MeasureReport</h1>
                </div>
            </div>
        </div>
    </div>

    {{range $index, $group := .Group}}
        {{$groupPopulation := index .Population 0}}
        <div class="overflow-hidden rounded-lg bg-white shadow-sm dark:bg-gray-800/50 dark:shadow-none dark:outline dark:-outline-offset-1 dark:outline-white/10 mb-8">
            <div class="px-4 py-5 sm:p-6">
                <div class="sm:flex sm:items-center sm:justify-between">
                    <h2 class="text-2xl/7 font-semibold text-gray-900 dark:text-white">
                        {{inc $index}}. {{or (and .Code .Code.Text) "Group"}}
                    </h2>
                    <div class="mt-3 flex sm:mt-0 sm:ml-4 text-gray-900 dark:text-white">
                        Count: {{$groupPopulation.Count}}
                    </div>
                </div>
            </div>
        </div>

        {{range .Stratifier}}
            <div class="overflow-hidden rounded-lg bg-white shadow-sm dark:bg-gray-800/50 dark:shadow-none dark:outline dark:-outline-offset-1 dark:outline-white/10 mb-8">
                <div class="px-4 py-5 sm:p-6">
                    <div class="px-4 sm:px-6 lg:px-8">
                        <div class="sm:flex sm:items-center">
                            <div class="sm:flex-auto">
                                <h3 class="text-base font-semibold text-gray-900 dark:text-white">{{with index .Code 0}}{{.Text}}{{end}}</h3>
                            </div>
                        </div>

                        <div class="mt-8 flow-root">
                            <div class="-mx-4 -my-2 overflow-x-auto sm:-mx-6 lg:-mx-8">
                                <div class="inline-block min-w-full py-2 align-middle sm:px-6 lg:px-8">
                                    {{$numStrata := len .Stratum}}
                                    {{if and (eq $numStrata 1) (isNullString (index .Stratum 0).Value.Text)}}
                                        <p>nothing</p>
                                    {{else}}
                                        <table class="relative min-w-full divide-y divide-gray-300 dark:divide-white/15">
                                            <thead>
                                            <tr class="divide-x divide-gray-200 dark:divide-white/10">
                                                <th scope="col"
                                                    class="p-4 sm:pl-0 text-sm text-left font-semibold whitespace-nowrap text-gray-900 dark:text-white">
                                                    #
                                                </th>
                                                <th scope="col"
                                                    class="p-4 text-sm text-left font-semibold whitespace-nowrap text-gray-900 dark:text-white">
                                                    System
                                                </th>
                                                <th scope="col"
                                                    class="p-4 text-sm text-left font-semibold whitespace-nowrap text-gray-900 dark:text-white">
                                                    Code
                                                </th>
                                                <th scope="col"
                                                    class="p-4 text-sm text-left font-semibold whitespace-nowrap text-gray-900 dark:text-white">
                                                    Display / Text
                                                </th>
                                                <th scope="col"
                                                    class="p-4 text-sm text-right font-semibold whitespace-nowrap text-gray-900 dark:text-white">
                                                    Count
                                                </th>
                                                <th scope="col"
                                                    class="p-4 sm:pr-0 text-sm text-right font-semibold whitespace-nowrap text-gray-900 dark:text-white">
                                                    Ratio
                                                </th>
                                            </tr>
                                            </thead>
                                            <tbody class="divide-y divide-gray-200 dark:divide-white/10">
                                            {{range $stratumIndex, $stratum := .Stratum}}
                                                {{with .Value}}
                                                    {{$numCodings := len .Coding}}
                                                    {{range $codingIndex, $coding := .Coding}}
                                                        <tr class="divide-x divide-gray-200 dark:divide-white/10 {{if and (gt $codingIndex 0) (lt (inc $codingIndex) $numCodings)}}border-hidden{{end}}">
                                                            {{if eq $codingIndex 0}}
                                                                <td class="p-4 sm:pl-0 text-sm align-top font-medium whitespace-nowrap text-gray-900 dark:text-white"
                                                                    rowspan="{{$numCodings}}">
                                                                    {{$stratumIndex}}
                                                                </td>
                                                            {{end}}
                                                            <td class="p-4 text-sm font-medium whitespace-nowrap text-gray-900 dark:text-white">
                                                                {{with .System}}{{.}}{{else}}–{{end}}
                                                            </td>
                                                            <td class="p-4 text-sm font-medium whitespace-nowrap text-gray-900 dark:text-white">
                                                                {{with .Code}}{{.}}{{else}}–{{end}}
                                                            </td>
                                                            <td class="p-4 text-sm font-medium whitespace-nowrap text-gray-900 dark:text-white">
                                                                {{with .Display}}{{.}}{{else}}–{{end}}
                                                            </td>
                                                            {{if eq $codingIndex 0}}
                                                                {{with index $stratum.Population 0}}
                                                                    <td class="p-4 text-sm text-right align-top font-medium whitespace-nowrap text-gray-900 dark:text-white"
                                                                        rowspan="{{$numCodings}}">
                                                                        {{.Count}}
                                                                    </td>
                                                                    <td class="p-4 sm:pr-0 text-sm text-right align-top font-medium whitespace-nowrap text-gray-900 dark:text-white"
                                                                        rowspan="{{$numCodings}}">
                                                                        {{ratio .Count $groupPopulation.Count | printf "%.2f %%"}}
                                                                    </td>
                                                                {{end}}
                                                            {{end}}
                                                        </tr>
                                                    {{else}}
                                                        {{if not (isNullString .Text)}}
                                                            <tr class="divide-x divide-gray-200 dark:divide-white/10">
                                                                <td class="p-4 sm:pl-0 text-sm font-medium whitespace-nowrap text-gray-900 dark:text-white">
                                                                    {{$stratumIndex}}
                                                                </td>
                                                                <td class="p-4 text-sm font-medium whitespace-nowrap text-gray-900 dark:text-white">
                                                                    –
                                                                </td>
                                                                <td class="p-4 text-sm font-medium whitespace-nowrap text-gray-900 dark:text-white">
                                                                    –
                                                                </td>
                                                                <td class="p-4 text-sm font-medium whitespace-nowrap text-gray-900 dark:text-white">
                                                                    {{.Text}}
                                                                </td>
                                                                {{with index $stratum.Population 0}}
                                                                    <td class="p-4 text-sm text-right font-medium whitespace-nowrap text-gray-900 dark:text-white">
                                                                        {{.Count}}
                                                                    </td>
                                                                    <td class="p-4 sm:pr-0 text-sm text-right font-medium whitespace-nowrap text-gray-900 dark:text-white">
                                                                        {{ratio .Count $groupPopulation.Count | printf "%.2f %%"}}
                                                                    </td>
                                                                {{end}}
                                                            </tr>
                                                        {{end}}
                                                    {{end}}
                                                {{end}}
                                            {{end}}
                                            </tbody>
                                        </table>
                                    {{end}}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        {{end}}
    {{end}}
</div>
</body>
</html>
